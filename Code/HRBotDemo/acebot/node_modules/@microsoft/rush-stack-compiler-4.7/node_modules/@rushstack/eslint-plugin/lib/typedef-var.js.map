{"version":3,"file":"typedef-var.js","sourceRoot":"","sources":["../src/typedef-var.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport type { TSESLint, TSESTree } from '@typescript-eslint/experimental-utils';\nimport { AST_NODE_TYPES } from '@typescript-eslint/experimental-utils';\n\ntype MessageIds = 'expected-typedef' | 'expected-typedef-named';\ntype Options = [];\n\nconst typedefVar: TSESLint.RuleModule<MessageIds, Options> = {\n  meta: {\n    type: 'problem',\n    messages: {\n      'expected-typedef-named': 'Expected a type annotation.',\n      'expected-typedef': 'Expected {{name}} to have a type annotation.'\n    },\n    schema: [\n      {\n        type: 'object',\n        additionalProperties: false\n      }\n    ],\n    docs: {\n      description:\n        'Supplements the \"@typescript-eslint/typedef\" rule by relaxing the requirements for local variables',\n      // Deprecated in ESLint v8; Keep for backwards compatibility\n      category: 'Stylistic Issues',\n      recommended: 'error',\n      url: 'https://www.npmjs.com/package/@rushstack/eslint-plugin'\n    } as TSESLint.RuleMetaDataDocs\n  },\n\n  create: (context: TSESLint.RuleContext<MessageIds, Options>) => {\n    // This rule implements the variableDeclarationIgnoreFunction=true behavior from\n    // @typescript-eslint/typedef\n    function isVariableDeclarationIgnoreFunction(node: TSESTree.Node): boolean {\n      return (\n        node.type === AST_NODE_TYPES.FunctionExpression ||\n        node.type === AST_NODE_TYPES.ArrowFunctionExpression\n      );\n    }\n\n    function getNodeName(node: TSESTree.Parameter | TSESTree.PropertyName): string | undefined {\n      return node.type === AST_NODE_TYPES.Identifier ? node.name : undefined;\n    }\n\n    return {\n      VariableDeclarator(node): void {\n        if (node.id.typeAnnotation) {\n          // An explicit type declaration was provided\n          return;\n        }\n\n        // These are @typescript-eslint/typedef exemptions\n        if (\n          node.id.type === AST_NODE_TYPES.ArrayPattern /* ArrayDestructuring */ ||\n          node.id.type === AST_NODE_TYPES.ObjectPattern /* ObjectDestructuring */ ||\n          (node.init && isVariableDeclarationIgnoreFunction(node.init))\n        ) {\n          return;\n        }\n\n        // Ignore this case:\n        //\n        //   for (const NODE of thing) { }\n        let current: TSESTree.Node | undefined = node.parent;\n        while (current) {\n          switch (current.type) {\n            case AST_NODE_TYPES.VariableDeclaration:\n              // Keep looking upwards\n              current = current.parent;\n              break;\n            case AST_NODE_TYPES.ForOfStatement:\n            case AST_NODE_TYPES.ForInStatement:\n              // Stop traversing and don't report an error\n              return;\n            default:\n              // Stop traversing\n              current = undefined;\n              break;\n          }\n        }\n\n        // Is it a local variable?\n        current = node.parent;\n        while (current) {\n          switch (current.type) {\n            // function f() {\n            //   const NODE = 123;\n            // }\n            case AST_NODE_TYPES.FunctionDeclaration:\n\n            // class C {\n            //   public m(): void {\n            //     const NODE = 123;\n            //   }\n            // }\n            case AST_NODE_TYPES.MethodDefinition:\n\n            // let f = function() {\n            //   const NODE = 123;\n            // }\n            case AST_NODE_TYPES.FunctionExpression:\n\n            // let f = () => {\n            //   const NODE = 123;\n            // }\n            case AST_NODE_TYPES.ArrowFunctionExpression:\n              // Stop traversing and don't report an error\n              return;\n          }\n\n          current = current.parent;\n        }\n\n        const nodeName: string | undefined = getNodeName(node.id);\n        if (nodeName) {\n          context.report({\n            node,\n            messageId: 'expected-typedef-named',\n            data: { name: nodeName }\n          });\n        } else {\n          context.report({\n            node,\n            messageId: 'expected-typedef'\n          });\n        }\n      }\n    };\n  }\n};\n\nexport { typedefVar };\n"]}