{"version":3,"file":"readme.js","sourceRoot":"","sources":["../src/readme.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as path from 'path';\r\nimport * as fs from 'fs';\r\nimport type { TSESLint, TSESTree } from '@typescript-eslint/experimental-utils';\r\nimport { ESLintUtils } from '@typescript-eslint/experimental-utils';\r\n\r\nimport { PackletAnalyzer } from './PackletAnalyzer';\r\n\r\nexport type MessageIds = 'missing-readme' | 'error-reading-file' | 'readme-too-short';\r\ntype Options = [\r\n  {\r\n    minimumReadmeWords?: number;\r\n  }\r\n];\r\n\r\nconst readme: TSESLint.RuleModule<MessageIds, Options> = {\r\n  meta: {\r\n    type: 'problem',\r\n    messages: {\r\n      'missing-readme':\r\n        'The ESLint configuration requires each packlet to provide a README.md file summarizing' +\r\n        ' its purpose and usage: {{readmePath}}',\r\n      'readme-too-short':\r\n        'The ESLint configuration requires at least {{minimumReadmeWords}} words of documentation in the' +\r\n        ' README.md file: {{readmePath}}',\r\n      'error-reading-file': 'Error reading input file {{readmePath}}:\\n{{errorMessage}}'\r\n    },\r\n    schema: [\r\n      {\r\n        type: 'object',\r\n        properties: {\r\n          minimumReadmeWords: {\r\n            type: 'number'\r\n          }\r\n        },\r\n        additionalProperties: false\r\n      }\r\n    ],\r\n\r\n    docs: {\r\n      description: 'Require each packlet folder to have a README.md file summarizing its purpose and usage',\r\n      // Deprecated in ESLint v8; Keep for backwards compatibility\r\n      category: 'Best Practices',\r\n      // Too strict to be recommended in the default configuration\r\n      recommended: false,\r\n      url: 'https://www.npmjs.com/package/@rushstack/eslint-plugin-packlets'\r\n    } as TSESLint.RuleMetaDataDocs\r\n  },\r\n\r\n  create: (context: TSESLint.RuleContext<MessageIds, Options>) => {\r\n    const minimumReadmeWords: number = context.options[0]?.minimumReadmeWords || 10;\r\n\r\n    // Example: /path/to/my-project/src/packlets/my-packlet/index.ts\r\n    const inputFilePath: string = context.getFilename();\r\n\r\n    // Example: /path/to/my-project/tsconfig.json\r\n    const tsconfigFilePath: string | undefined = ESLintUtils.getParserServices(\r\n      context\r\n    ).program.getCompilerOptions()['configFilePath'] as string;\r\n\r\n    const packletAnalyzer: PackletAnalyzer = PackletAnalyzer.analyzeInputFile(\r\n      inputFilePath,\r\n      tsconfigFilePath\r\n    );\r\n\r\n    if (!packletAnalyzer.nothingToDo && !packletAnalyzer.error) {\r\n      if (packletAnalyzer.isEntryPoint) {\r\n        return {\r\n          Program: (node: TSESTree.Node): void => {\r\n            const readmePath: string = path.join(\r\n              packletAnalyzer.packletsFolderPath!,\r\n              packletAnalyzer.inputFilePackletName!,\r\n              'README.md'\r\n            );\r\n            try {\r\n              if (!fs.existsSync(readmePath)) {\r\n                context.report({\r\n                  node: node,\r\n                  messageId: 'missing-readme',\r\n                  data: { readmePath }\r\n                });\r\n              } else {\r\n                if (minimumReadmeWords > 0) {\r\n                  const readmeContent: string = fs.readFileSync(readmePath).toString();\r\n                  const words: string[] = readmeContent.split(/[^a-z'\"]+/i).filter((x) => x.length > 0);\r\n                  if (words.length < minimumReadmeWords) {\r\n                    context.report({\r\n                      node: node,\r\n                      messageId: 'readme-too-short',\r\n                      data: { readmePath, minimumReadmeWords }\r\n                    });\r\n                  }\r\n                }\r\n              }\r\n            } catch (error) {\r\n              context.report({\r\n                node: node,\r\n                messageId: 'error-reading-file',\r\n                data: { readmePath, errorMessage: (error as Error).toString() }\r\n              });\r\n            }\r\n          }\r\n        };\r\n      }\r\n    }\r\n\r\n    return {};\r\n  }\r\n};\r\n\r\nexport { readme };\r\n"]}