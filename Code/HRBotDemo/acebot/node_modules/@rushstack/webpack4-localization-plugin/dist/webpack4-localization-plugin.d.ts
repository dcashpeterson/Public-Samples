import type { IgnoreStringFunction } from '@rushstack/localization-utilities';
import { ILocalizationFile } from '@rushstack/localization-utilities';
import type { IPseudolocaleOptions } from '@rushstack/localization-utilities';
import { ITerminal } from '@rushstack/node-core-library';
import * as Webpack from 'webpack';

/**
 * @internal
 */
declare interface IAddDefaultLocFileResult {
    /**
     * A list of paths to translation files that were loaded
     */
    additionalLoadedFilePaths: string[];
    errors: Error[];
}

/**
 * @public
 */
export declare interface IDefaultLocaleOptions {
    /**
     * This required property specifies the name of the locale used in the
     * `.resx`, `.loc.json`, and `.resjson` files in the source
     */
    localeName: string;
    /**
     * If this option is set to `true`, strings that are missing from
     * `localizedData.translatedStrings` will be provided by the default locale
     */
    fillMissingTranslationStrings?: boolean;
}

/**
 * @public
 */
export declare interface ILocaleData {
    [locFilePath: string]: string | ILocaleFileData;
}

/**
 * @public
 */
export declare interface ILocaleElementMap {
    [locale: string]: string;
}

/**
 * @public
 */
export declare interface ILocaleFileData {
    [stringName: string]: string;
}

/**
 * The options for localization.
 *
 * @public
 */
export declare interface ILocalizationPluginOptions {
    /**
     * Localization data.
     */
    localizedData: ILocalizedData;
    /**
     * This option is used to specify `.resx`, `.resx.json`, and `.loc.json` files that should not be processed by
     * this plugin.
     */
    globsToIgnore?: string[];
    /**
     * The value to replace the [locale] token with for chunks without localized strings. Defaults to "none"
     */
    noStringsLocaleName?: string;
    /**
     * Options for how localization stats data should be produced.
     */
    localizationStats?: ILocalizationStatsOptions;
    /**
     * This option is used to specify how and if TypeScript typings should be generated for loc files.
     */
    typingsOptions?: ITypingsGenerationOptions;
    /**
     * Optionally, provide a function that will be called for each string. If the function returns `true`
     * the string will not be included.
     */
    ignoreString?: IgnoreStringFunction;
    /**
     * @deprecated
     * Use {@link ILocalizationPluginOptions.globsToIgnore} instead.
     *
     * @internalRemarks
     * TODO: Remove when version 1.0.0 is released.
     */
    filesToIgnore?: string[];
}

/**
 * @public
 */
export declare interface ILocalizationStats {
    entrypoints: {
        [name: string]: ILocalizationStatsEntrypoint;
    };
    namedChunkGroups: {
        [name: string]: ILocalizationStatsChunkGroup;
    };
}

/**
 * @public
 */
export declare interface ILocalizationStatsChunkGroup {
    localizedAssets: ILocaleElementMap;
}

/**
 * @public
 */
export declare interface ILocalizationStatsEntrypoint {
    localizedAssets: ILocaleElementMap;
}

/**
 * Options for how localization stats data should be produced.
 *
 * @public
 */
export declare interface ILocalizationStatsOptions {
    /**
     * This option is used to designate a path at which a JSON file describing the localized
     * assets produced should be written.
     */
    dropPath?: string;
    /**
     * This option is used to specify a callback to be called with the stats data that would be
     * dropped at `localizationStats.dropPath` after compilation completes.
     */
    callback?: (stats: ILocalizationStats) => void;
}

/**
 * @public
 */
export declare interface ILocalizedData {
    /**
     * Options for the locale used in the source localized data files.
     */
    defaultLocale: IDefaultLocaleOptions;
    /**
     * Use this parameter to specify the translated data.
     */
    translatedStrings: ILocalizedStrings;
    /**
     * Use this parameter to specify a function used to load translations missing from
     * the {@link ILocalizedData.translatedStrings} parameter.
     */
    resolveMissingTranslatedStrings?: (locales: string[], filePath: string) => IResolvedMissingTranslations;
    /**
     * Options around including a passthrough locale.
     */
    passthroughLocale?: IPassthroughLocaleOptions;
    /**
     * Options for pseudo-localization.
     */
    pseudolocales?: IPseudolocalesOptions;
    /**
     * Normalize newlines in RESX files to either CRLF (Windows-style) or LF ('nix style)
     */
    normalizeResxNewlines?: 'lf' | 'crlf';
    /**
     * If set to true, do not warn on missing RESX `<data>` element comments.
     */
    ignoreMissingResxComments?: boolean;
}

/**
 * @public
 */
export declare interface ILocalizedStrings {
    [locale: string]: ILocaleData;
}

/**
 * @public
 */
export declare interface ILocalizedWebpackChunk extends Webpack.compilation.Chunk {
    localizedFiles?: {
        [locale: string]: string;
    };
}

/**
 * Options for the passthrough locale.
 *
 * @public
 */
export declare interface IPassthroughLocaleOptions {
    /**
     * If this is set to `true`, a passthrough locale will be included in the output
     */
    usePassthroughLocale?: boolean;
    /**
     * If {@link IPassthroughLocaleOptions.usePassthroughLocale} is set, use this name for the passthrough locale.
     * Defaults to "passthrough"
     */
    passthroughLocaleName?: string;
}

/**
 * Options for generated pseudolocales.
 *
 * @public
 */
export declare interface IPseudolocalesOptions {
    [pseudoLocaleName: string]: IPseudolocaleOptions;
}

/**
 * @public
 */
export declare interface IResolvedMissingTranslations {
    [localeName: string]: string | ILocaleFileData;
}

/**
 * @internal
 */
export declare interface _IStringPlaceholder {
    value: string;
    suffix: string;
}

/**
 * @internal
 */
declare interface IStringSerialNumberData {
    values: ILocaleElementMap;
    locFilePath: string;
    stringName: string;
}

/**
 * Options for typing generation.
 *
 * @public
 */
export declare interface ITypingsGenerationOptions {
    /**
     * This property specifies the folder in which `.d.ts` files for loc files should be dropped.
     */
    generatedTsFolder: string;
    /**
     * Optional additional folders into which `.d.ts` files for loc files should be dropped.
     */
    secondaryGeneratedTsFolders?: string[];
    /**
     * This optional property overrides the compiler context for discovery of localization files
     * for which typings should be generated.
     */
    sourceRoot?: string;
    /**
     * If this option is set to `true`, loc modules typings will be exported wrapped in a `default` property.
     */
    exportAsDefault?: boolean;
    /**
     * @deprecated
     * Use {@link ILocalizationPluginOptions.ignoreString} instead.
     *
     * @internalRemarks
     * TODO: Remove when version 1.0.0 is released.
     */
    ignoreString?: (resxFilePath: string, stringName: string) => boolean;
    /**
     * Optionally, provide a function that will process string comments. The returned value will become the
     * TSDoc comment for the string in the typings.
     */
    processComment?: (comment: string | undefined, resxFilePath: string, stringName: string) => string | undefined;
}

/**
 * This plugin facilitates localization in webpack.
 *
 * @public
 */
export declare class LocalizationPlugin implements Webpack.Plugin {
    /**
     * @internal
     */
    stringKeys: Map<string, _IStringPlaceholder>;
    private _options;
    private _resolvedTranslatedStringsFromOptions;
    private _globsToIgnore;
    private _stringPlaceholderCounter;
    private _stringPlaceholderMap;
    private _locales;
    private _passthroughLocaleName;
    private _defaultLocale;
    private _noStringsLocaleName;
    private _fillMissingTranslationStrings;
    private _pseudolocalizers;
    private _resxNewlineNormalization;
    private _ignoreMissingResxComments;
    /**
     * The outermost map's keys are the locale names.
     * The middle map's keys are the resolved, file names.
     * The innermost map's keys are the string identifiers and its values are the string values.
     */
    private _resolvedLocalizedStrings;
    constructor(options: ILocalizationPluginOptions);
    apply(compiler: Webpack.Compiler): void;
    /**
     * @internal
     *
     * @returns
     */
    addDefaultLocFile(terminal: ITerminal, localizedResourcePath: string, localizedResourceData: ILocalizationFile): IAddDefaultLocFileResult;
    /**
     * @internal
     */
    getDataForSerialNumber(serialNumber: string): IStringSerialNumberData | undefined;
    private _addLocFile;
    private _initializeAndValidateOptions;
    private _getPlaceholderString;
    private _chunkHasLocalizedModules;
    private _convertLocalizationFileToLocData;
}

export { }
