"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startApplication = void 0;
var tslib_1 = require("tslib");
var SPComponentLoader_1 = require("../../loader/SPComponentLoader");
var ComponentStore_1 = tslib_1.__importDefault(require("../../stores/ComponentStore"));
var ManifestStore_1 = tslib_1.__importDefault(require("../../stores/ManifestStore"));
var componentConstants_1 = require("../../utilities/componentConstants");
function startApplication(preloadedData, serviceScope) {
    return new Promise(function (resolve) {
        updateServiceWorkerState();
        var appBaseManifest = ManifestStore_1.default.instance.tryGetManifest(componentConstants_1.spApplicationBaseComponentId);
        var app;
        if (appBaseManifest) {
            var appBase = ComponentStore_1.default.instance.tryGetComponentReference(appBaseManifest.id, appBaseManifest.version);
            if (appBase) {
                app = navigateToApplication(appBase, preloadedData, serviceScope);
            }
        }
        resolve(app);
    })
        .then(function (app) {
        if (!app) {
            return SPComponentLoader_1.SPComponentLoader.loadComponentById(componentConstants_1.spApplicationBaseComponentId).then(function (a) { return navigateToApplication(a, preloadedData, serviceScope); });
        }
        return app;
    })
        .catch(function (e) {
        throw e;
    });
}
exports.startApplication = startApplication;
function updateServiceWorkerState() {
    var _a;
    try {
        if ((_a = window.navigator.serviceWorker) === null || _a === void 0 ? void 0 : _a.controller) {
            sessionStorage.setItem('serviceworkerstate', window.navigator.serviceWorker.controller.state.toString());
        }
        else {
            sessionStorage.removeItem('serviceworkerstate');
        }
    }
    catch (e) {
        // catch
    }
}
function navigateToApplication(appBase, preloadedData, serviceScope) {
    return new appBase._Navigator(serviceScope).navigateToApplication(preloadedData);
}
//# sourceMappingURL=platformLoader.js.map