{"version":3,"file":"CollatedWriter.js","sourceRoot":"","sources":["../src/CollatedWriter.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,kDAA4E;AAG5E,yDAAsD;AAEtD;;;;GAIG;AACH,MAAa,cAAe,SAAQ,2BAAgB;IAOlD,YAAmB,QAAgB,EAAE,QAAwB;QAC3D,KAAK,CAAC,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC,CAAC;QAElC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,QAAQ,GAAG,IAAI,mCAAgB,CAAC,IAAI,CAAC,CAAC;QAE3C,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAE1B,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;IAC5B,CAAC;IAED;;OAEG;IACH,IAAW,QAAQ;QACjB,OAAO,IAAI,CAAC,SAAS,CAAC,YAAY,KAAK,IAAI,CAAC;IAC9C,CAAC;IAED;;;OAGG;IACH,IAAW,cAAc;QACvB,OAAO,IAAI,CAAC,eAAe,CAAC;IAC9B,CAAC;IAED,sEAAsE;IAC/D,YAAY,CAAC,KAAqB;QACvC,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IACtE,CAAC;IAED,iEAAiE;IAC1D,OAAO;QACZ,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IAC1D,CAAC;IAED,gBAAgB;IACT,oBAAoB;QACzB,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,eAAe,EAAE;YACxC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;SAC9C;QACD,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC;IAClC,CAAC;CACF;AAlDD,wCAkDC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport { type ITerminalChunk, TerminalWritable } from '@rushstack/terminal';\n\nimport type { StreamCollator } from './StreamCollator';\nimport { CollatedTerminal } from './CollatedTerminal';\n\n/**\n * An writable interface for managing output of simultaneous processes.\n *\n * @beta\n */\nexport class CollatedWriter extends TerminalWritable {\n  private readonly _collator: StreamCollator;\n  private readonly _bufferedChunks: ITerminalChunk[];\n\n  public readonly taskName: string;\n  public readonly terminal: CollatedTerminal;\n\n  public constructor(taskName: string, collator: StreamCollator) {\n    super({ preventAutoclose: true });\n\n    this.taskName = taskName;\n    this.terminal = new CollatedTerminal(this);\n\n    this._collator = collator;\n\n    this._bufferedChunks = [];\n  }\n\n  /**\n   * Returns true if this is the active writer for its associated {@link StreamCollator}.\n   */\n  public get isActive(): boolean {\n    return this._collator.activeWriter === this;\n  }\n\n  /**\n   * For diagnostic purposes, if the writer is buffering chunks because it has\n   * not become active yet, they can be inspected via this property.\n   */\n  public get bufferedChunks(): ReadonlyArray<ITerminalChunk> {\n    return this._bufferedChunks;\n  }\n\n  /** {@inheritDoc @rushstack/terminal#TerminalWritable.onWriteChunk} */\n  public onWriteChunk(chunk: ITerminalChunk): void {\n    this._collator._writerWriteChunk(this, chunk, this._bufferedChunks);\n  }\n\n  /** {@inheritDoc @rushstack/terminal#TerminalWritable.onClose} */\n  public onClose(): void {\n    this._collator._writerClose(this, this._bufferedChunks);\n  }\n\n  /** @internal */\n  public _flushBufferedChunks(): void {\n    for (const chunk of this._bufferedChunks) {\n      this._collator.destination.writeChunk(chunk);\n    }\n    this._bufferedChunks.length = 0;\n  }\n}\n"]}