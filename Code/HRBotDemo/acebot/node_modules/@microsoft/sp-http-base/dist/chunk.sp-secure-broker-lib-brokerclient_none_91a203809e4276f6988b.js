(window.webpackJsonp_8496636c_2300_4915_abef_20de64c98d8b_1_18_2=window.webpackJsonp_8496636c_2300_4915_abef_20de64c98d8b_1_18_2||[]).push([[9],{oWJm:function(e,t,n){"use strict";n.r(t),n.d(t,"_SECURE_BROKER_DOMAIN",function(){return u}),n.d(t,"_BrokerClient",function(){return f});var a=n("17wl"),i=n("UWqr"),r=n("ut3N"),o=n("X+PM"),s="customerPromise";function c(){return i._SPKillSwitch.isActivated("f493582d-419b-4ae5-b7f6-661d8cdb87bd")}function d(){return i._SPKillSwitch.isActivated("b84efa6b-2b1e-4cfa-8cc1-402f5bae17a5")}var l=n("K9kD"),u="https://securebroker.sharepointonline.com",f=function(){function e(){}return e.getSecureBrokerDomain=function(t){if(i._SPKillSwitch.isActivated("3fc826ca-47b0-4b83-9635-0fc559c73003"))return u;if(e._TARGET_ORIGIN_OPTION.targetOrigin)return e._TARGET_ORIGIN_OPTION.targetOrigin;try{var n=t.consume(o.PageContext.serviceKey).legacyPageContext.secureBrokerDomainName;return n?n="https://".concat(n):e._logSecureBrokerDomainError(),n||u}catch(t){return e._logSecureBrokerDomainError(),u}},e.getAuthToken=function(t,n,a,o,s,c){void 0===o&&(o=!1);var l,u=new r._QosMonitor("BrokerClient.getAuthToken",!0),f={isIsolated:"false"},p=!1;if(d())m=(m=window.location.origin.split(".")[0]).substring(m.lastIndexOf("-app")),p=!!i.Guid.tryParse(m.substring(m.length-36));else try{var m;m=(m=window.location.origin.split(".")[0]).substring(m.lastIndexOf("-app")),p=!!i.Guid.tryParse(m.substring(m.length-36)),f.isIsolated=String(p)}catch(e){f.isIsolated=JSON.stringify(e)}return e._ensureBrokerWindow(n,o).then(function(n){return l=Date.now(),e._getAuthToken(t,n,a,o,s,c)}).then(function(t){return i._SPKillSwitch.isActivated("fd1c6d26-8d0e-4148-a9f1-36a8b5f4eeff")||performance.measure("TeamsTokenFetch",{start:l-performance.timeOrigin,end:Date.now()-performance.timeOrigin}),t?(d()?u.writeSuccess({isIsolated:p}):u.writeSuccess(f),o&&(e._brokerClientPerfMarks.SSBBrokerLogonGetAuthTokenEnd=Date.now()),Promise.resolve(t)):Promise.reject("UndefinedAuthToken")}).catch(function(e){return d()?u.writeUnexpectedFailure(e,new Error(e),{isIsolated:p}):u.writeUnexpectedFailure(e,new Error(e),f),Promise.reject("BrokerClient.getAuthToken Rejected: ".concat(e))})},e.getPerfMarks=function(t){return e._ensureBrokerWindow(t).then(function(t){return e._getPerfMarks(t)}).then(function(t){var n=Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},t),e._brokerClientPerfMarks),e._firstBrokerLoginLoadPerfMarks);return Promise.resolve(n)}).catch(function(e){return Promise.reject("BrokerClient.getPerformanceMarks reject: ".concat(e))})},e.markCustomerPromiseEnd=function(t,n){c()||e._ensureBrokerWindow(n).then(function(n){var a={action:s,endCPData:t};n.postMessage(a,e._TARGET_ORIGIN_OPTION)}).catch(function(e){})},e.markCustomerPromiseFailure=function(t,n){c()||e._ensureBrokerWindow(n).then(function(n){var a={action:s,endCPData:{resultType:l.ResultTypeEnum.Failure,errorCode:t}};n.postMessage(a,e._TARGET_ORIGIN_OPTION)}).catch(function(e){})},e.addVanityDomainsForTeamsJs=function(t){var n=new Promise(function(t){return e._teamsJsDomainsAddedCallback=t});return Promise.all([e._ensureBrokerWindow(t).then(function(t){t.postMessage({action:"teamsJsAdditionalValidDomains"},e._TARGET_ORIGIN_OPTION)}).catch(function(){}),n]).then()},e.logPerformance=function(t,n,i,r){e._ensureBrokerWindow(n).then(function(n){var o=Object(a.__assign)(Object(a.__assign)({},e._brokerClientPerfMarks),t);0===Object.keys(e._firstBrokerLoginLoadPerfMarks).length&&(e._firstBrokerLoginLoadPerfMarks=t);var s={action:"logPerfMarkers",marks:o,error:i,hadRetry:r};n.postMessage(s,e._TARGET_ORIGIN_OPTION),e._brokerClientPerfMarks={}}).catch(function(e){})},e.markContentPageLoaded=function(t,n,a){e._ensureBrokerWindow(n).then(function(n){var i={action:"contentPageLoaded",result:t,errorMessage:a};n.postMessage(i,e._TARGET_ORIGIN_OPTION)}).catch(function(e){})},e.initializeBrokerClient=function(e){this._ensureBrokerWindow(e).catch(function(e){})},e._getAuthToken=function(t,n,a,o,s,c){var d=this;void 0===o&&(o=!1);var l,u={action:"requestToken",claims:a,resource:t,identifier:e._messageIdentifier,correlationId:s};o&&(e._brokerClientPerfMarks.SSBBrokerLogonRequestTokenStart=Date.now());var f=new Promise(function(t,n){var a=e._messageIdentifier++;e._getAuthTokenResolvers.set(a,{reject:n,resolve:t,timeout:l})});return n.postMessage(u,e._TARGET_ORIGIN_OPTION),Promise.race([f,new Promise(function(e,u){l=setTimeout(function(){if(!i._SPKillSwitch.isActivated("c86e5bc9-b3a1-414b-b884-f3148cacdeb8")&&c){var e=new r._QosMonitor("BrokerClient.getAuthTokenRetry",!0);return d._getAuthToken(t,n,a,o,s,!1).then(function(t){return e.writeSuccess(),t}).catch(function(t){throw e.writeUnexpectedFailure("FailedToGetRetryToken",t),t})}u("GetAuthTokenTimeout")},1e4)})])},e._getPerfMarks=function(t){e._getPerfMarksPromise=new Promise(function(t){e._getPerfMarksResolver=t});return t.postMessage({action:"getPerfMarkers"},e._TARGET_ORIGIN_OPTION),e._getPerfMarksAndTimeOutPromise=Promise.race([e._getPerfMarksPromise,new Promise(function(t,n){e._getPerfMarksTimeOutPromise=setTimeout(function(){n("GetPerfMarkersTimeout")},1e4)})]),e._getPerfMarksAndTimeOutPromise},e._logSecureBrokerDomainError=function(){new r._QosMonitor("SecureBrokerDomainMissing").writeUnexpectedFailure()},e._ensureSecureBrokerDomain=function(t){e._TARGET_ORIGIN_OPTION.targetOrigin=e.getSecureBrokerDomain(t)},e._ensureBrokerWindow=function(t,n){if(void 0===n&&(n=!1),n&&(e._brokerClientPerfMarks.SSBBrokerLogonFindBrokerWindowStart=Date.now()),!e._secureBrokerWindowAndTimeOutPromise){e._secureBrokerWindowMonitor=new r._QosMonitor("BrokerClient.EnsureBrokerWindow"),e._secureBrokerWindowPromise=new Promise(function(t){e._secureBrokerWindowResolver=t}),e._ensureMessageHandlers();var a=window,i={action:"getBrokerWindow",isBrokerLoginLoad:n};for(e._ensureSecureBrokerDomain(t);a!==a.parent;)a.parent.postMessage(i,e.getSecureBrokerDomain(t)),a=a.parent;e._secureBrokerWindowAndTimeOutPromise=Promise.race([e._secureBrokerWindowPromise,new Promise(function(t,n){e._timeOutPromise=setTimeout(function(){var t;n("EnsureBrokerWindowTimeout"),null===(t=e._secureBrokerWindowMonitor)||void 0===t||t.writeUnexpectedFailure("EnsureBrokerWindowTimeout")},1e4)})])}return e._secureBrokerWindowAndTimeOutPromise},e._ensureMessageHandlers=function(){e._messageHandlersAdded||(window.addEventListener("message",e._handleMessage),e._messageHandlersAdded=!0)},e._handleMessage=function(t){var n,a;if(t.origin&&t.data&&t.origin===e.getSecureBrokerDomain())if("ackBrokerWindow"===t.data.action)clearTimeout(e._timeOutPromise),e._secureBrokerWindowResolver(t.source),null===(n=e._secureBrokerWindowMonitor)||void 0===n||n.writeSuccess({brokerCorrelationId:t.data.correlationId}),t.data.isBrokerLoginLoad&&(e._brokerClientPerfMarks.SSBBrokerLogonFindBrokerWindowSuccess=Date.now());else if("returnToken"===t.data.action){var i=t.data,r=e._getAuthTokenResolvers.get(i.requestIdentifier);clearTimeout(r.timeout),r.resolve(i.result)}else if("rejectToken"===t.data.action||"errorOriginDoesNotMatchRequestedToken"===t.data.action)i=t.data,r=e._getAuthTokenResolvers.get(i.requestIdentifier),clearTimeout(r.timeout),r.reject("".concat(t.data.action,": ").concat(t.data.error,"}"));else if("returnPerfMarkers"===t.data.action){var o=t.data.marks;clearTimeout(e._getPerfMarksTimeOutPromise),e._getPerfMarksResolver(o)}else"teamsJsDomainSuccessfullyAdded"===t.data.action&&(null===(a=e._teamsJsDomainsAddedCallback)||void 0===a||a.call(e))},e._TARGET_ORIGIN_OPTION={targetOrigin:void 0},e._messageIdentifier=0,e._getAuthTokenResolvers=new Map,e._brokerClientPerfMarks={},e._firstBrokerLoginLoadPerfMarks={},e}()}}]);