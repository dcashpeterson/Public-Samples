{"version":3,"file":"no-unsafe-regexp.js","sourceRoot":"","sources":["../src/no-unsafe-regexp.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAG3D,8EAAuE;AAEvE,0DAAsD;AAEtD,mCAAmC;AACnC,yBAAyB;AACzB,EAAE;AACF,QAAQ;AACR,MAAM;AACN,+BAA+B;AAC/B,kBAAkB;AAClB,8BAA8B;AAC9B,yBAAyB;AACzB,SAAS;AACT,qBAAqB;AACrB,UAAU;AACV,6BAA6B;AAC7B,gCAAgC;AAChC,+BAA+B;AAC/B,UAAU;AACV,QAAQ;AACR,MAAM;AACN,MAAM,gBAAgB,GAAgB,IAAI,0BAAW,CAAC;IACpD,IAAI,EAAE,eAAe;IACrB,MAAM,EAAE;QACN,IAAI,EAAE,YAAY;QAClB,IAAI,EAAE,QAAQ;KACf;IACD,SAAS,EAAE,0BAAW,CAAC,GAAG,CAAC,iBAAiB,CAAC;CAC9C,CAAC,CAAC;AASH,MAAM,cAAc,GAA6C;IAC/D,IAAI,EAAE;QACJ,IAAI,EAAE,SAAS;QACf,QAAQ,EAAE;YACR,qBAAqB,EACnB,+FAA+F;gBAC/F,8FAA8F;gBAC9F,4CAA4C;SAC/C;QACD,MAAM,EAAE;YACN;gBACE,IAAI,EAAE,QAAQ;gBACd,oBAAoB,EAAE,KAAK;aAC5B;SACF;QACD,IAAI,EAAE;YACJ,WAAW,EACT,8FAA8F;gBAC9F,+BAA+B;YACjC,4DAA4D;YAC5D,QAAQ,EAAE,gBAAgB;YAC1B,WAAW,EAAE,MAAM;YACnB,GAAG,EAAE,iEAAiE;SAC1C;KAC/B;IAED,MAAM,EAAE,CAAC,OAAkD,EAAE,EAAE;QAC7D,OAAO;YACL,aAAa,EAAE,CAAC,IAA4B,EAAQ,EAAE;gBACpD,MAAM,QAAQ,GAA8B,EAAE,CAAC;gBAC/C,IAAI,gBAAgB,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,eAAe,EAAE;oBACtE,IACE,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC;wBACnC,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,mCAAc,CAAC,OAAO,EAC3D;wBACA,OAAO,CAAC,MAAM,CAAC;4BACb,IAAI;4BACJ,SAAS,EAAE,qBAAqB;yBACjC,CAAC,CAAC;qBACJ;iBACF;YACH,CAAC;SACF,CAAC;IACJ,CAAC;CACF,CAAC;AAEO,wCAAc","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport type { TSESLint, TSESTree } from '@typescript-eslint/experimental-utils';\nimport { AST_NODE_TYPES } from '@typescript-eslint/experimental-utils';\n\nimport { TreePattern } from '@rushstack/tree-pattern';\n\n// Matches an expression like this:\n//   new RegExp('hello');\n//\n// Tree:\n//   {\n//     \"type\": \"NewExpression\",\n//     \"callee\": {\n//       \"type\": \"Identifier\",\n//       \"name\": \"RegExp\"\n//     },\n//     \"arguments\": [\n//       {\n//         \"type\": \"Literal\",\n//         \"raw\": \"'\\\"hello\\\"'\",\n//         \"value\": \"\\\"hello\\\"\"\n//       }\n//     ]\n//   }\nconst newRegExpPattern: TreePattern = new TreePattern({\n  type: 'NewExpression',\n  callee: {\n    type: 'Identifier',\n    name: 'RegExp'\n  },\n  arguments: TreePattern.tag('constructorArgs')\n});\n\ninterface INewRegExpPatternCaptures {\n  constructorArgs?: TSESTree.Expression[];\n}\n\ntype MessageIds = 'error-unsafe-regexp';\ntype Options = [];\n\nconst noUnsafeRegExp: TSESLint.RuleModule<MessageIds, Options> = {\n  meta: {\n    type: 'problem',\n    messages: {\n      'error-unsafe-regexp':\n        'Regular expressions should be constructed from string constants. Dynamically building strings' +\n        ' at runtime may introduce security vulnerabilities, performance concerns, and bugs involving' +\n        ' incorrect escaping of special characters.'\n    },\n    schema: [\n      {\n        type: 'object',\n        additionalProperties: false\n      }\n    ],\n    docs: {\n      description:\n        'Requires regular expressions to be constructed from string constants rather than dynamically' +\n        ' building strings at runtime.',\n      // Deprecated in ESLint v8; Keep for backwards compatibility\n      category: 'Best Practices',\n      recommended: 'warn',\n      url: 'https://www.npmjs.com/package/@rushstack/eslint-plugin-security'\n    } as TSESLint.RuleMetaDataDocs\n  },\n\n  create: (context: TSESLint.RuleContext<MessageIds, Options>) => {\n    return {\n      NewExpression: (node: TSESTree.NewExpression): void => {\n        const captures: INewRegExpPatternCaptures = {};\n        if (newRegExpPattern.match(node, captures) && captures.constructorArgs) {\n          if (\n            captures.constructorArgs.length > 0 &&\n            captures.constructorArgs[0].type !== AST_NODE_TYPES.Literal\n          ) {\n            context.report({\n              node,\n              messageId: 'error-unsafe-regexp'\n            });\n          }\n        }\n      }\n    };\n  }\n};\n\nexport { noUnsafeRegExp };\n"]}