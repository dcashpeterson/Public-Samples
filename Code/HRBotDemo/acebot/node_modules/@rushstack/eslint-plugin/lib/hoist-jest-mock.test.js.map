{"version":3,"file":"hoist-jest-mock.test.js","sourceRoot":"","sources":["../src/hoist-jest-mock.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { ESLintUtils } from '@typescript-eslint/experimental-utils';\r\nimport { hoistJestMock } from './hoist-jest-mock';\r\n\r\nconst { RuleTester } = ESLintUtils;\r\nconst ruleTester = new RuleTester({\r\n  parser: '@typescript-eslint/parser',\r\n  parserOptions: {\r\n    ecmaVersion: 2018,\r\n    sourceType: 'module'\r\n  }\r\n});\r\n\r\n// These are the CODE_WITH_HOISTING cases from ts-jest's hoist-jest.spec.ts\r\nconst INVALID_EXAMPLE_CODE = [\r\n  /* 001 */ \"require('foo')\",\r\n  /* 002 */ 'console.log(foo)',\r\n  /* 003 */ 'jest.enableAutomock()',\r\n  /* 004 */ 'jest.disableAutomock()',\r\n  /* 005 */ \"jest.mock('./foo')\",\r\n  /* 006 */ \"jest.mock('./foo/bar', () => 'bar')\",\r\n  /* 007 */ \"jest.unmock('./bar/foo').dontMock('./bar/bar')\",\r\n  /* 008 */ \"jest.deepUnmock('./foo')\",\r\n  /* 009 */ \"jest.mock('./foo').mock('./bar')\",\r\n  /* 010 */ 'const func = () => {',\r\n  /* 011 */ \"  const bar = 'bar'\",\r\n  /* 012 */ '  console.log(bar)',\r\n  /* 013 */ \"  jest.unmock('./foo')\",\r\n  /* 014 */ \"  jest.mock('./bar')\",\r\n  /* 015 */ \"  jest.mock('./bar/foo', () => 'foo')\",\r\n  /* 016 */ \"  jest.unmock('./foo/bar')\",\r\n  /* 017 */ \"  jest.unmock('./bar/foo').dontMock('./bar/bar')\",\r\n  /* 018 */ \"  jest.deepUnmock('./bar')\",\r\n  /* 019 */ \"  jest.mock('./foo').mock('./bar')\",\r\n  /* 020 */ '}',\r\n  /* 021 */ 'const func2 = () => {',\r\n  /* 022 */ \"  const bar = 'bar'\",\r\n  /* 023 */ '  console.log(bar)',\r\n  /* 024 */ \"  jest.mock('./bar')\",\r\n  /* 025 */ \"  jest.unmock('./foo/bar')\",\r\n  /* 026 */ \"  jest.mock('./bar/foo', () => 'foo')\",\r\n  /* 027 */ \"  jest.unmock('./foo')\",\r\n  /* 028 */ \"  jest.unmock('./bar/foo').dontMock('./bar/bar')\",\r\n  /* 029 */ \"  jest.deepUnmock('./bar')\",\r\n  /* 030 */ \"  jest.mock('./foo').mock('./bar')\",\r\n  /* 031 */ '}'\r\n].join('\\n');\r\n\r\nruleTester.run('hoist-jest-mock', hoistJestMock, {\r\n  invalid: [\r\n    {\r\n      // Detect all the Jest APIs detected by ts-jest\r\n      code: INVALID_EXAMPLE_CODE,\r\n      errors: [\r\n        { messageId: 'error-unhoisted-jest-mock', line: 3 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 4 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 5 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 6 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 7 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 8 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 9 },\r\n\r\n        { messageId: 'error-unhoisted-jest-mock', line: 13 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 14 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 15 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 16 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 17 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 18 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 19 },\r\n\r\n        { messageId: 'error-unhoisted-jest-mock', line: 24 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 25 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 26 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 27 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 28 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 29 },\r\n        { messageId: 'error-unhoisted-jest-mock', line: 30 }\r\n      ]\r\n    },\r\n    {\r\n      // A simple failure using realistic code\r\n      // prettier-ignore\r\n      code: [\r\n        \"const soundPlayer = require('./SoundPlayer');\",\r\n        \"jest.mock('./SoundPlayer');\"\r\n      ].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    },\r\n    {\r\n      // Import syntaxes that should fail\r\n      code: [\"import x from 'y';\", 'jest.mock();'].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    },\r\n    // {\r\n    //   // Import syntaxes that should fail\r\n    //   code: [\"export { x } from 'y';\", 'jest.mock();'].join('\\n'),\r\n    //   errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    // },\r\n    {\r\n      // Import syntaxes that should fail\r\n      code: [\"import * as x from 'y';\", 'jest.mock();'].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    },\r\n    // {\r\n    //   // Import syntaxes that should fail\r\n    //   code: [\"export * from 'y';\", 'jest.mock();'].join('\\n'),\r\n    //   errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    // },\r\n    {\r\n      // Import syntaxes that should fail\r\n      code: [\"import 'y';\", 'jest.mock();'].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    },\r\n    {\r\n      // Import syntaxes that should fail\r\n      code: [\"const x = require('package-name');\", 'jest.mock();'].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    },\r\n    {\r\n      // Import syntaxes that should fail\r\n      code: [\"const x = import('package-name');\", 'jest.mock();'].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    },\r\n    {\r\n      // Import syntaxes that should fail\r\n      code: [\"import x = require('package-name');\", 'jest.mock();'].join('\\n'),\r\n      errors: [{ messageId: 'error-unhoisted-jest-mock', line: 2 }]\r\n    }\r\n  ],\r\n  valid: [\r\n    {\r\n      // A simple success using realistic code\r\n      code: [\r\n        'const mockPlaySoundFile = jest.fn();',\r\n        \"jest.mock('./SoundPlayer', () => {\",\r\n        '  return {',\r\n        '    SoundPlayer: jest.fn().mockImplementation(() => {',\r\n        '      return { playSoundFile: mockPlaySoundFile };',\r\n        '    })',\r\n        '  };',\r\n        '});'\r\n      ].join('\\n')\r\n    }\r\n  ]\r\n});\r\n"]}