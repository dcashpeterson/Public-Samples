{"version":3,"file":"no-untyped-underscore.js","sourceRoot":"","sources":["../src/no-untyped-underscore.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAQ3D,MAAM,uBAAuB,GAA6C;IACxE,IAAI,EAAE;QACJ,IAAI,EAAE,SAAS;QACf,QAAQ,EAAE;YACR,0BAA0B,EACxB,uEAAuE;gBACvE,sFAAsF;SACzF;QACD,MAAM,EAAE,EAAE;QACV,IAAI,EAAE;YACJ,WAAW,EACT,kEAAkE;gBAClE,wCAAwC;YAC1C,4DAA4D;YAC5D,QAAQ,EAAE,kBAAkB;YAC5B,WAAW,EAAE,KAAK;YAClB,GAAG,EAAE,wDAAwD;SACjC;KAC/B;IACD,MAAM,EAAE,CAAC,OAAkD,EAAE,EAAE;QAC7D,MAAM,cAAc,GAA+B,OAAO,CAAC,cAAc,CAAC;QAC1E,IAAI,CAAC,cAAc,IAAI,CAAC,cAAc,CAAC,OAAO,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE;YACvF,MAAM,IAAI,KAAK,CACb,oFAAoF;gBAClF,4CAA4C,CAC/C,CAAC;SACH;QAED,MAAM,WAAW,GAAmB,cAAc,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;QAE5E,OAAO;YACL,gBAAgB,EAAE,UAAU,IAA+B;gBACzD,kCAAkC;gBAElC,+DAA+D;gBAC/D,MAAM,YAAY,GAAoC,IAAI,CAAC,MAAM,CAAC;gBAClE,IAAI,YAAY,EAAE;oBAChB,IAAI,YAAY,CAAC,IAAI,KAAK,OAAO,IAAI,YAAY,CAAC,IAAI,KAAK,gBAAgB,EAAE;wBAC3E,OAAO,CAAC,WAAW;qBACpB;oBACD,IAAI,YAAY,CAAC,IAAI,KAAK,YAAY,EAAE;wBACtC,IAAI,YAAY,CAAC,IAAI,KAAK,MAAM,IAAI,YAAY,CAAC,IAAI,IAAI,MAAM,EAAE;4BAC/D,OAAO,CAAC,WAAW;yBACpB;qBACF;iBACF;gBAED,gEAAgE;gBAChE,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,YAAY,EAAE;oBACxD,MAAM,UAAU,GAAW,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;oBAC9C,IAAI,UAAU,IAAI,UAAU,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;wBACvC,4DAA4D;wBAC5D,EAAE;wBACF,0CAA0C;wBAC1C,EAAE;wBACF,yBAAyB;wBACzB,cAAc;wBACd,oBAAoB;wBACpB,8BAA8B;wBAC9B,QAAQ;wBACR,EAAE;wBACF,wCAAwC;wBACxC,iBAAiB;wBACjB,uCAAuC;wBACvC,EAAE;wBACF,IAAI,YAAY,GAA0B,SAAS,CAAC;wBAEpD,MAAM,gBAAgB,GAAwB,cAAc,CAAC,qBAAsB,CAAC,GAAG,CACrF,IAAI,CAAC,MAAM,CACZ,CAAC;wBACF,IAAI,gBAAgB,EAAE;4BACpB,MAAM,gBAAgB,GAAwB,WAAW,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC;4BAC9F,IAAI,gBAAgB,EAAE;gCACpB,YAAY,GAAG,gBAAgB,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;6BACzD;yBACF;wBAED,qFAAqF;wBACrF,sFAAsF;wBACtF,IAAI,CAAC,YAAY,EAAE;4BACjB,OAAO,CAAC,MAAM,CAAC;gCACb,IAAI;gCACJ,SAAS,EAAE,0BAA0B;gCACrC,IAAI,EAAE,EAAE,UAAU,EAAE,UAAU,EAAE;6BACjC,CAAC,CAAC;yBACJ;qBACF;iBACF;YACH,CAAC;SACF,CAAC;IACJ,CAAC;CACF,CAAC;AAEO,0DAAuB","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { TSESTree, TSESLint, ParserServices } from '@typescript-eslint/experimental-utils';\r\nimport * as ts from 'typescript';\r\n\r\ntype MessageIds = 'error-untyped-underscore';\r\ntype Options = [];\r\n\r\nconst noUntypedUnderscoreRule: TSESLint.RuleModule<MessageIds, Options> = {\r\n  meta: {\r\n    type: 'problem',\r\n    messages: {\r\n      'error-untyped-underscore':\r\n        'This expression appears to access a private member \"{{memberName}}\"; ' +\r\n        'either remove the underscore prefix or else declare a type for the containing object'\r\n    },\r\n    schema: [],\r\n    docs: {\r\n      description:\r\n        'Prevent TypeScript code from accessing legacy JavaScript members' +\r\n        ' whose names have an underscore prefix',\r\n      // Deprecated in ESLint v8; Keep for backwards compatibility\r\n      category: 'Stylistic Issues',\r\n      recommended: false,\r\n      url: 'https://www.npmjs.com/package/@rushstack/eslint-plugin'\r\n    } as TSESLint.RuleMetaDataDocs\r\n  },\r\n  create: (context: TSESLint.RuleContext<MessageIds, Options>) => {\r\n    const parserServices: ParserServices | undefined = context.parserServices;\r\n    if (!parserServices || !parserServices.program || !parserServices.esTreeNodeToTSNodeMap) {\r\n      throw new Error(\r\n        'This rule requires your ESLint configuration to define the \"parserOptions.project\"' +\r\n          ' property for \"@typescript-eslint/parser\".'\r\n      );\r\n    }\r\n\r\n    const typeChecker: ts.TypeChecker = parserServices.program.getTypeChecker();\r\n\r\n    return {\r\n      MemberExpression: function (node: TSESTree.MemberExpression) {\r\n        // Is it an expression like \"x.y\"?\r\n\r\n        // Ignore expressions such as \"super.y\", \"this.y\", and \"that.y\"\r\n        const memberObject: TSESTree.LeftHandSideExpression = node.object;\r\n        if (memberObject) {\r\n          if (memberObject.type === 'Super' || memberObject.type === 'ThisExpression') {\r\n            return; // no match\r\n          }\r\n          if (memberObject.type === 'Identifier') {\r\n            if (memberObject.name === 'this' || memberObject.name == 'that') {\r\n              return; // no match\r\n            }\r\n          }\r\n        }\r\n\r\n        // Does the member name start with an underscore?  (e.g. \"x._y\")\r\n        if (node.property && node.property.type === 'Identifier') {\r\n          const memberName: string = node.property.name;\r\n          if (memberName && memberName[0] === '_') {\r\n            // Do we have type information for the property (e.g. \"_y\")?\r\n            //\r\n            // Examples where propertyType is defined:\r\n            //\r\n            //    let x: { _y: any };\r\n            //    let x: {\r\n            //      _y: boolean;\r\n            //      [key: string]: number;\r\n            //    };\r\n            //\r\n            // Examples with propertyType=undefined:\r\n            //    let x: any;\r\n            //    let x: { [key: string]: number };\r\n            //\r\n            let propertyType: ts.Symbol | undefined = undefined;\r\n\r\n            const memberObjectNode: ts.Node | undefined = parserServices.esTreeNodeToTSNodeMap!.get(\r\n              node.object\r\n            );\r\n            if (memberObjectNode) {\r\n              const memberObjectType: ts.Type | undefined = typeChecker.getTypeAtLocation(memberObjectNode);\r\n              if (memberObjectType) {\r\n                propertyType = memberObjectType.getProperty(memberName);\r\n              }\r\n            }\r\n\r\n            // TypeScript's type system already sufficiently restricts access to private members.\r\n            // Thus, this ESLint rule only considers untyped code such as a legacy JavaScript API.\r\n            if (!propertyType) {\r\n              context.report({\r\n                node,\r\n                messageId: 'error-untyped-underscore',\r\n                data: { memberName: memberName }\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nexport { noUntypedUnderscoreRule };\r\n"]}