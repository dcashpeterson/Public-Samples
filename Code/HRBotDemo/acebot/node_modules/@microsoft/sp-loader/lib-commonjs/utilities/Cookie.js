"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var KillSwitches_1 = require("./KillSwitches");
var Cookie = /** @class */ (function () {
    function Cookie(cookie) {
        this._cookie = cookie || document.cookie;
    }
    Cookie.tryGetCookie = function (cookieId) {
        return new Cookie().tryGetCookie(cookieId);
    };
    Cookie.setCookie = function (id, value, attributes) {
        document.cookie = this.buildCookie(id, value, attributes);
    };
    Cookie.buildCookie = function (id, value, attributes) {
        var cookieData = [];
        var secureAttributeAdded = false;
        // If the value includes disallowed character, encode the value
        if (value.indexOf(' ') !== -1 || value.indexOf(',') !== -1 || value.indexOf(';') !== -1) {
            value = encodeURIComponent(value);
        }
        cookieData.push("".concat(id, "=").concat(value));
        if (!(0, KillSwitches_1.isSetSameSiteByDefaultKSActivated)() && (!attributes || !(attributes === null || attributes === void 0 ? void 0 : attributes.sameSite))) {
            attributes = tslib_1.__assign(tslib_1.__assign({}, attributes), { sameSite: 'none' });
        }
        if (attributes) {
            if (attributes.path) {
                cookieData.push("path=".concat(attributes.path));
            }
            if (attributes.domain) {
                cookieData.push("domain=".concat(attributes.domain));
            }
            if (attributes.maxAge) {
                cookieData.push("max-age=".concat(attributes.maxAge));
            }
            if (attributes.expires) {
                cookieData.push("expires=".concat(attributes.expires.toUTCString()));
            }
            if (attributes.sameSite) {
                cookieData.push("samesite=".concat(attributes.sameSite));
                if (attributes.sameSite === 'none') {
                    cookieData.push("secure");
                    secureAttributeAdded = true;
                }
            }
            if (!secureAttributeAdded && attributes.secure) {
                cookieData.push("secure");
            }
        }
        return cookieData.join('; ');
    };
    Cookie.prototype.tryGetCookie = function (cookieId) {
        var prefix = cookieId + '=';
        var keyValuePair = this._cookie
            .split(';') // Different cookies are separated by semi-colon
            .map(function (str) { return str.trim(); }) // Trimming in order to do prefix matching
            .filter(function (str) { return str.indexOf(prefix) === 0; })[0]; // All cookies are in the form ID=VALUE. Returns the first value
        // Returns the value if it exists, otherwise returns undefined
        return keyValuePair ? keyValuePair.substr(prefix.length) : undefined;
    };
    return Cookie;
}());
exports.default = Cookie;
//# sourceMappingURL=Cookie.js.map