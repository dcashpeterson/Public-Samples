"use strict";
/**
 *
 * Sub-component for TraceList. The header displays the currently selected filters.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = tslib_1.__importStar(require("react"));
var Styling_1 = require("@fluentui/react/lib/Styling");
var TraceDisplayStore_1 = require("../../../../../Stores/TraceDisplayStore");
var TraceListHeader_module_scss_1 = tslib_1.__importDefault(require("./TraceListHeader.module.scss"));
var TraceDisplay_resx_1 = tslib_1.__importDefault(require("../../TraceDisplay.resx"));
var TraceListHeader = /** @class */ (function (_super) {
    tslib_1.__extends(TraceListHeader, _super);
    function TraceListHeader(props) {
        var _this = _super.call(this, props) || this;
        _this._handleLevelClick = function () {
            _this._toggleFilterStateForColumn('level');
        };
        _this._handleScopeClick = function () {
            _this._toggleFilterStateForColumn('scope');
        };
        _this._handleSourceClick = function () {
            _this._toggleFilterStateForColumn('source');
        };
        _this._handleFilterChange = _this._handleFilterChange.bind(_this);
        // At page load time the default is to show no filter overlays
        _this.state = {
            filterToggles: { level: false, scope: false, source: false }
        };
        return _this;
    }
    TraceListHeader.prototype.render = function () {
        var _this = this;
        return (React.createElement("ul", { className: TraceListHeader_module_scss_1.default.container },
            React.createElement("li", { className: TraceListHeader_module_scss_1.default.timestamp }, TraceDisplay_resx_1.default.TimestampHeaderLabel),
            React.createElement("li", { className: TraceListHeader_module_scss_1.default.level },
                React.createElement("p", { role: 'button', onClick: this._handleLevelClick, className: TraceListHeader_module_scss_1.default.headerText }, TraceDisplay_resx_1.default.LevelHeaderLabel),
                React.createElement("button", { onClick: this._handleLevelClick, className: [TraceListHeader_module_scss_1.default.filterButton, (0, Styling_1.getIconClassName)('Filter')].join(' ') }),
                React.createElement("div", { className: this._getFilterStyleForColumn('level'), id: 'levelFilterDropdown' }, Object.keys(this.props.filters.level).map(function (id) { return (React.createElement("div", { key: id, className: TraceListHeader_module_scss_1.default.filterRow },
                    React.createElement("input", { type: 'checkbox', name: 'level '.concat(id), "aria-checked": _this.props.filters.level[id], checked: _this.props.filters.level[id], onChange: _this._handleFilterChange }),
                    id)); }))),
            React.createElement("li", { className: TraceListHeader_module_scss_1.default.scope },
                React.createElement("p", { role: 'button', onClick: this._handleScopeClick, className: TraceListHeader_module_scss_1.default.headerText }, TraceDisplay_resx_1.default.ScopeHeaderLabel),
                React.createElement("button", { onClick: this._handleScopeClick, className: [TraceListHeader_module_scss_1.default.filterButton, (0, Styling_1.getIconClassName)('Filter')].join(' ') }),
                React.createElement("div", { className: this._getFilterStyleForColumn('scope'), id: 'scopeFilterDropdown' }, Object.keys(this.props.filters.scope).map(function (id) { return (React.createElement("div", { key: id, className: TraceListHeader_module_scss_1.default.filterRow },
                    React.createElement("input", { type: 'checkbox', name: 'scope '.concat(id), "aria-checked": _this.props.filters.scope[id], checked: _this.props.filters.scope[id], onChange: _this._handleFilterChange }),
                    id)); }))),
            React.createElement("li", { className: TraceListHeader_module_scss_1.default.source },
                React.createElement("p", { role: 'button', onClick: this._handleSourceClick, className: TraceListHeader_module_scss_1.default.headerText }, TraceDisplay_resx_1.default.SourceHeaderLabel),
                React.createElement("button", { onClick: this._handleSourceClick, className: [TraceListHeader_module_scss_1.default.filterButton, (0, Styling_1.getIconClassName)('Filter')].join(' ') }),
                React.createElement("div", { className: this._getFilterStyleForColumn('source'), id: 'sourceFilterDropdown' }, Object.keys(this.props.filters.source).map(function (id) { return (React.createElement("div", { key: id, className: TraceListHeader_module_scss_1.default.filterRow },
                    React.createElement("input", { type: 'checkbox', name: 'source '.concat(id), "aria-checked": _this.props.filters.source[id], checked: _this.props.filters.source[id], onChange: _this._handleFilterChange }),
                    id)); }))),
            React.createElement("li", { className: TraceListHeader_module_scss_1.default.message }, TraceDisplay_resx_1.default.MessageHeaderLabel)));
    };
    /**
     * Returns the current display style for the dropdown filter overlays.
     */
    TraceListHeader.prototype._getFilterStyleForColumn = function (columnId) {
        var filterStyle = this.state.filterToggles[columnId] ? TraceListHeader_module_scss_1.default.displayBlock : TraceListHeader_module_scss_1.default.displayNone;
        return [TraceListHeader_module_scss_1.default.filterOverlay, filterStyle].join(' ');
    };
    /**
     * Inverts the display status (None or Block) for the dropdown overlay column
     * that has the corresponding title of the param 'columnID'. Leaves all other
     * dropdown overlays unchanged.
     *
     * Ex: If columnId is 'level' and the current overlay display style is 'None', then the
     * display style for the level overlay will be changed to 'Block' and the other overlays
     * ('scope', 'source') will remain as is.
     */
    TraceListHeader.prototype._toggleFilterStateForColumn = function (columnId) {
        var filterToggles = { level: false, scope: false, source: false };
        for (var toggle in this.state.filterToggles) {
            if (this.state.filterToggles.hasOwnProperty(toggle)) {
                var value = this.state.filterToggles[toggle];
                filterToggles[toggle] = columnId === toggle ? !value : value;
            }
        }
        this.setState({ filterToggles: filterToggles });
    };
    TraceListHeader.prototype._handleFilterChange = function (event) {
        var all = 'all';
        var name = 'name';
        var eventTargetNameAttribute = event.target.getAttribute(name) || '';
        var filterDetailsTuple = eventTargetNameAttribute.split(' ');
        var filterType = filterDetailsTuple[0];
        var filterSubType = filterDetailsTuple[1];
        var subfilters = this.props.filters[filterType];
        if (filterSubType === all) {
            subfilters[all] = !subfilters[all];
            Object.keys(subfilters).forEach(function (element, count, array) {
                subfilters[element] = subfilters[all];
            });
        }
        else {
            subfilters[all] = false;
            subfilters[filterSubType] = !subfilters[filterSubType];
            var allTrue_1 = true;
            Object.keys(subfilters).forEach(function (key) {
                if (key !== all && subfilters[key] === false) {
                    allTrue_1 = false;
                }
            });
            if (allTrue_1) {
                subfilters[all] = true;
            }
        }
        TraceDisplayStore_1.TraceDisplayStore.instance.applyTraceFilter(this.props.filters);
    };
    return TraceListHeader;
}(React.Component));
exports.default = TraceListHeader;
//# sourceMappingURL=TraceListHeader.js.map